<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ç©¿æ­é¡§å•</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ FontAwesome åœ–ç¤º -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* è‡ªå®šç¾©å­—é«”å’ŒèƒŒæ™¯ï¼Œæ›´æ¥è¿‘åœ–ç‰‡é¢¨æ ¼ */
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f5f7fa; /* æŸ”å’Œçš„æ·ºç°èƒŒæ™¯ */
        }
        .weather-card {
            background: white;
            border-radius: 1.5rem; /* å¤§åœ“è§’ */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }
        .advisor-card {
            background: linear-gradient(to bottom right, #ffffff, #f0f4ff); /* å¾®æ¼¸å±¤èƒŒæ™¯ */
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.02);
        }
    </style>
</head>
<body class="min-h-screen p-4 flex items-center justify-center font-sans text-gray-700">

    <div class="w-full max-w-md mx-auto">
        <h1 class="text-2xl font-bold text-center mb-6 text-gray-800">å¤©æ°£èˆ‡ç©¿æ­</h1>
        
        <!-- æ–°å¢ï¼šæ¨¡å‹é¸æ“‡å€ (é…åˆé›²ç«¯ç‰ˆ) -->
        <div class="mb-4 flex flex-col items-end px-2">
            <div class="flex items-center gap-2">
                <label class="text-xs text-gray-500 font-bold"><i class="fa-solid fa-microchip"></i> AI æ¨¡å‹:</label>
                <select id="modelSelect" class="text-sm border border-gray-300 rounded-lg px-2 py-1 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="llama-3.1-8b-instant">è¼‰å…¥ä¸­...</option>
                </select>
            </div>
            <p class="text-[10px] text-gray-400 mt-1">ğŸ’¡ é›²ç«¯ç‰ˆå·²é€£çµ Groq é«˜é€Ÿæ¨¡å‹</p>
        </div>

        <!-- æœå°‹å€ -->
        <div class="flex gap-2 mb-6 shadow-sm rounded-full bg-white p-1">
            <input type="text" id="cityInput" placeholder="è¼¸å…¥åŸå¸‚ (ä¾‹å¦‚: Taipei)" 
                   class="flex-1 rounded-full px-6 py-3 focus:outline-none text-gray-600 bg-transparent">
            <button onclick="getRecommendation()" 
                    class="bg-blue-500 text-white p-3 rounded-full hover:bg-blue-600 transition-colors w-12 h-12 flex items-center justify-center">
                <i class="fa-solid fa-magnifying-glass"></i>
            </button>
        </div>

        <!-- è¼‰å…¥ä¸­å‹•ç•« -->
        <div id="loading" class="hidden text-center py-10">
            <i class="fa-solid fa-circle-notch fa-spin text-4xl text-blue-400"></i>
            <p class="text-gray-500 mt-4 text-sm font-medium animate-pulse">AI æ­£åœ¨åˆ†æå¤©æ°£æ•¸æ“š...</p>
        </div>

        <!-- çµæœé¡¯ç¤ºå€ -->
        <div id="result" class="hidden space-y-5">
            
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-gray-800" id="cityName">--</h2>
                <p class="text-gray-500 text-lg flex items-center justify-center gap-2 mt-1">
                    <span id="weatherDesc">--</span>
                </p>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="weather-card p-5 flex flex-col items-center justify-center text-center bg-blue-50/50">
                    <i class="fa-solid fa-umbrella text-blue-400 text-2xl mb-2"></i>
                    <p class="text-xs text-gray-500 font-medium">é™é›¨æ©Ÿç‡</p>
                    <p class="text-xl font-bold text-gray-800"><span id="rainChance">--</span>%</p>
                </div>
                <div class="weather-card p-5 flex flex-col items-center justify-center text-center bg-orange-50/50">
                    <i class="fa-solid fa-temperature-half text-orange-400 text-2xl mb-2"></i>
                    <p class="text-xs text-gray-500 font-medium">é«”æ„Ÿæº«åº¦</p>
                    <p class="text-xl font-bold text-gray-800"><span id="feelsLike">--</span>Â°</p>
                </div>
                <div class="weather-card p-5 flex flex-col items-center justify-center text-center bg-teal-50/50">
                    <i class="fa-solid fa-droplet text-teal-400 text-2xl mb-2"></i>
                    <p class="text-xs text-gray-500 font-medium">æ¿•åº¦</p>
                    <p class="text-xl font-bold text-gray-800"><span id="humidity">--</span>%</p>
                </div>
                <div class="weather-card p-5 flex flex-col items-center justify-center text-center bg-indigo-50/50">
                    <i class="fa-solid fa-wind text-indigo-400 text-2xl mb-2"></i>
                    <p class="text-xs text-gray-500 font-medium">é¢¨é€Ÿ</p>
                    <p class="text-xl font-bold text-gray-800"><span id="windSpeed">--</span> <span class="text-xs">ç´š</span></p>
                </div>
            </div>

            <div class="advisor-card p-6 relative overflow-hidden">
                <div class="absolute -top-10 -right-10 w-32 h-32 bg-purple-100 rounded-full opacity-50"></div>

                <div class="flex items-center gap-3 mb-4 relative z-10">
                    <div class="bg-indigo-100 p-2 rounded-full">
                        <i class="fa-solid fa-shirt text-indigo-600 text-xl"></i>
                    </div>
                    <h3 class="font-bold text-lg text-gray-800">ç©¿è¡£é¡§å•</h3>
                </div>
                
                <div id="aiAdvice" class="text-gray-700 leading-relaxed text-[15px] relative z-10 whitespace-pre-line">
                    <!-- AI å»ºè­°å…§å®¹ -->
                </div>
            </div>

        </div>
    </div>

    <script>
        // é é¢è¼‰å…¥æ™‚ï¼Œè‡ªå‹•æŠ“å–å¾Œç«¯æä¾›çš„æ¨¡å‹åˆ—è¡¨
        window.onload = async function() {
            try {
                const response = await fetch('/models');
                const models = await response.json();
                const select = document.getElementById('modelSelect');
                select.innerHTML = ''; // æ¸…ç©ºé è¨­é¸é …

                models.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.text = model;
                    // é è¨­é¸å– Llama 3.1 8B (é€Ÿåº¦æœ€å¿«)
                    if (model.includes('8b-instant')) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });
            } catch (e) {
                console.error("ç„¡æ³•è¼‰å…¥æ¨¡å‹åˆ—è¡¨", e);
                // å¦‚æœå¤±æ•—ï¼Œè‡³å°‘ç•™ä¸€å€‹é è¨­é¸é …
                document.getElementById('modelSelect').innerHTML = '<option value="llama-3.1-8b-instant">Llama 3.1 (Default)</option>';
            }
        };

        // ç¶å®š Enter éµæœå°‹
        document.getElementById("cityInput").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                getRecommendation();
            }
        });

        async function getRecommendation() {
            const city = document.getElementById('cityInput').value;
            const model = document.getElementById('modelSelect').value; // å–å¾—é¸ä¸­çš„æ¨¡å‹
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            
            if (!city) return alert("è«‹è¼¸å…¥åŸå¸‚åç¨±ï¼");

            // UI åˆ‡æ›
            result.classList.add('hidden');
            loading.classList.remove('hidden');

            try {
                const formData = new FormData();
                formData.append('city', city);
                formData.append('model', model); // å‚³é€æ¨¡å‹åƒæ•¸çµ¦å¾Œç«¯

                const response = await fetch('/recommend', {
                    method: 'POST', body: formData
                });
                const data = await response.json();

                if (data.error) {
                    alert(data.error);
                } else {
                    // æ›´æ–°æ•¸æ“š
                    document.getElementById('cityName').textContent = data.weather.city;
                    document.getElementById('weatherDesc').innerHTML = `<i class="fa-solid fa-cloud"></i> ${data.weather.description}`;
                    document.getElementById('rainChance').textContent = data.weather.rain_chance;
                    document.getElementById('feelsLike').textContent = data.weather.feels_like;
                    document.getElementById('humidity').textContent = data.weather.humidity;
                    document.getElementById('windSpeed').textContent = data.weather.wind_speed;
                    
                    // æ›´æ–° AI å»ºè­°
                    document.getElementById('aiAdvice').textContent = data.advice;

                    // é¡¯ç¤ºçµæœ
                    result.classList.remove('hidden');
                }
            } catch (error) {
                console.error(error);
                alert("ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚ç¢ºèªå¾Œç«¯æ˜¯å¦åŸ·è¡Œä¸­ã€‚");
            } finally {
                loading.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
